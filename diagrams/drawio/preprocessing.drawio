<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:146.0) Gecko/20100101 Firefox/146.0" version="29.2.7">
  <diagram name="Preprocessing Pipeline" id="preprocessing-pipeline">
    <mxGraphModel dx="1600" dy="901" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="process-section" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="280" width="790" x="440" y="360" as="geometry" />
        </mxCell>
        <mxCell id="pipeline-container" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="700" width="1520" x="40" y="340" as="geometry" />
        </mxCell>
        <mxCell id="process-label" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=16;fontColor=#64748B;fontStyle=1" value="PROCESSING STEPS" vertex="1">
          <mxGeometry height="20" width="720" x="475" y="395" as="geometry" />
        </mxCell>
        <mxCell id="title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=33;fontColor=#64748B;fontStyle=1" value="PREPROCESSING PIPELINE (csttool preprocess)" vertex="1">
          <mxGeometry height="80" width="1470" x="45" y="20" as="geometry" />
        </mxCell>
        <mxCell id="inputs-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF7ED;strokeColor=#A25700;strokeWidth=1.5;labelPosition=center;verticalLabelPosition=middle;align=center;verticalAlign=middle;fontSize=18;fontColor=default;" value="&lt;div&gt;&lt;b&gt;Inputs:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;DICOM Series&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Courier New&quot;&gt;/path/to/dicom/&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OR NIfTI Dataset&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Courier New&quot;&gt;*.nii.gz + *.bval + *.bvec&lt;/font&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="215" width="280" x="80" y="105" as="geometry" />
        </mxCell>
        <mxCell id="outputs-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=1.5;labelPosition=center;verticalLabelPosition=middle;align=center;verticalAlign=middle;fontSize=18;fontColor=default;" value="&lt;div&gt;&lt;b&gt;Outputs:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Preprocessed DWI&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Courier New&quot;&gt;*_dwi_preproc.nii.gz&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Courier New&quot;&gt;*_dwi_preproc.bval&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Courier New&quot;&gt;*_dwi_preproc.bvec&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Brain Mask&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Courier New&quot;&gt;*_brain_mask.nii.gz&lt;/font&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="215" width="320" x="480" y="105" as="geometry" />
        </mxCell>
        <mxCell id="deps-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;strokeWidth=2;verticalAlign=middle;fontSize=18;" value="&lt;div&gt;&lt;b&gt;Dependencies:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;DIPY (denoise, mask, motion)&lt;/div&gt;&lt;div&gt;dicom2nifti&lt;/div&gt;&lt;div&gt;nibabel&lt;/div&gt;&lt;div&gt;numpy, scipy&lt;/div&gt;" vertex="1">
          <mxGeometry height="215" width="280" x="920" y="107.5" as="geometry" />
        </mxCell>
        <mxCell id="legend-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#E2E8F0;fontSize=15;" value="" vertex="1">
          <mxGeometry height="215" width="200" x="1315" y="105" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=15;" value="&lt;b&gt;Legend&lt;/b&gt;" vertex="1">
          <mxGeometry height="20" width="200" x="1315" y="115" as="geometry" />
        </mxCell>
        <mxCell id="legend-input" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;strokeWidth=2;fontSize=15;" value="" vertex="1">
          <mxGeometry height="15" width="20" x="1335" y="160" as="geometry" />
        </mxCell>
        <mxCell id="legend-input-text" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=15;" value="Input Data" vertex="1">
          <mxGeometry height="25" width="100" x="1365" y="155" as="geometry" />
        </mxCell>
        <mxCell id="legend-process" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=2;fontSize=15;" value="" vertex="1">
          <mxGeometry height="15" width="20" x="1335" y="190" as="geometry" />
        </mxCell>
        <mxCell id="legend-process-text" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=15;" value="Processing Step" vertex="1">
          <mxGeometry height="25" width="120" x="1365" y="185" as="geometry" />
        </mxCell>
        <mxCell id="legend-output" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=2;fontSize=15;" value="" vertex="1">
          <mxGeometry height="15" width="20" x="1335" y="220" as="geometry" />
        </mxCell>
        <mxCell id="legend-output-text" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=15;" value="Output / Artifact" vertex="1">
          <mxGeometry height="25" width="120" x="1365" y="215" as="geometry" />
        </mxCell>
        <mxCell id="legend-optional" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=2;fontSize=15;dashed=1;" value="" vertex="1">
          <mxGeometry height="15" width="20" x="1335" y="250" as="geometry" />
        </mxCell>
        <mxCell id="legend-optional-text" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontSize=15;" value="Optional Step" vertex="1">
          <mxGeometry height="25" width="120" x="1365" y="245" as="geometry" />
        </mxCell>
        <mxCell id="input-section" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="260" width="330" x="70" y="380" as="geometry" />
        </mxCell>
        <mxCell id="input-label" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=16;fontColor=#64748B;fontStyle=1" value="INPUT" vertex="1">
          <mxGeometry height="20" width="340" x="65" y="395" as="geometry" />
        </mxCell>
        <mxCell id="dicom" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;strokeWidth=2;" value="&lt;b&gt;DICOM Series&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;/path/to/dicom/&lt;/font&gt;" vertex="1">
          <mxGeometry height="60" width="130" x="80" y="430" as="geometry" />
        </mxCell>
        <mxCell id="avVJ5a976VpTCQXpxeIG-9" edge="1" parent="1" source="nifti" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=0;strokeColor=light-dark(#000000,#A4A4A4);strokeWidth=2;" target="load-dataset">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="nifti" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;strokeWidth=2;" value="&lt;b&gt;NIfTI Dataset&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;*.nii.gz&lt;br&gt;*.bval&lt;br&gt;*.bvec&lt;/font&gt;" vertex="1">
          <mxGeometry height="80" width="130" x="240" y="530" as="geometry" />
        </mxCell>
        <mxCell id="avVJ5a976VpTCQXpxeIG-2" edge="1" parent="1" source="dicom2nifti" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=light-dark(#000000,#A4A4A4);curved=0;strokeWidth=2;" target="nifti" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dicom2nifti" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=1.5;" value="&lt;b&gt;dicom2nifti&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;conversion&lt;/font&gt;" vertex="1">
          <mxGeometry height="60" width="130" x="240" y="430" as="geometry" />
        </mxCell>
        <mxCell id="arrow-dicom" edge="1" parent="1" source="dicom" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#555555;" target="dicom2nifti" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="load-dataset" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=1.5;" value="&lt;b&gt;load_dataset&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;+ gradient_table&lt;/font&gt;" vertex="1">
          <mxGeometry height="50" width="120" x="460" y="440" as="geometry" />
        </mxCell>
        <mxCell id="data-array" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=1;" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;data array&lt;br&gt;affine&lt;br&gt;gtab&lt;/font&gt;" vertex="1">
          <mxGeometry height="50" width="110" x="465" y="505" as="geometry" />
        </mxCell>
        <mxCell id="arrow-load-data" edge="1" parent="1" source="load-dataset" style="endArrow=classic;html=1;strokeWidth=1;strokeColor=#22C55E;" target="data-array" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-to-denoise" edge="1" parent="1" source="load-dataset" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#555555;" target="denoise" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="denoise" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=1.5;" value="&lt;b&gt;denoise_nlmeans&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;PIESNO noise est.&lt;br&gt;NLMEANS filter&lt;/font&gt;" vertex="1">
          <mxGeometry height="60" width="130" x="610" y="435" as="geometry" />
        </mxCell>
        <mxCell id="denoised" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=1;" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;denoised data&lt;/font&gt;" vertex="1">
          <mxGeometry height="35" width="110" x="620" y="510" as="geometry" />
        </mxCell>
        <mxCell id="arrow-denoise-out" edge="1" parent="1" source="denoise" style="endArrow=classic;html=1;strokeWidth=1;strokeColor=#22C55E;" target="denoised" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-to-mask" edge="1" parent="1" source="denoise" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#555555;" target="brain-mask" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="brain-mask" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=1.5;" value="&lt;b&gt;background_&lt;br&gt;segmentation&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;median_otsu on b0&lt;/font&gt;" vertex="1">
          <mxGeometry height="60" width="130" x="770" y="435" as="geometry" />
        </mxCell>
        <mxCell id="mask-out" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=1;" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;brain_mask&lt;br&gt;masked_data&lt;/font&gt;" vertex="1">
          <mxGeometry height="40" width="120" x="775" y="510" as="geometry" />
        </mxCell>
        <mxCell id="arrow-mask-out" edge="1" parent="1" source="brain-mask" style="endArrow=classic;html=1;strokeWidth=1;strokeColor=#22C55E;" target="mask-out" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-to-motion" edge="1" parent="1" source="brain-mask" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#555555;" target="motion-corr" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="motion-corr" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=1.5;dashed=1;" value="&lt;b&gt;perform_motion_&lt;br&gt;correction&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;(optional)&lt;br&gt;&lt;font color=&quot;#94a3b8&quot;&gt;--perform-mc&lt;/font&gt;&lt;/font&gt;" vertex="1">
          <mxGeometry height="70" width="130" x="930" y="430" as="geometry" />
        </mxCell>
        <mxCell id="motion-out" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=1;dashed=1;" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;corrected_data&lt;br&gt;reg_affines&lt;/font&gt;" vertex="1">
          <mxGeometry height="40" width="120" x="935" y="515" as="geometry" />
        </mxCell>
        <mxCell id="arrow-motion-out" edge="1" parent="1" source="motion-corr" style="endArrow=classic;html=1;strokeWidth=1;strokeColor=#22C55E;dashed=1;" target="motion-out" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-to-save" edge="1" parent="1" source="motion-corr" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#555555;" target="save-output" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="avVJ5a976VpTCQXpxeIG-8" edge="1" parent="1" source="save-output" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=0;strokeColor=light-dark(#22C55E,#008C34);strokeWidth=2;" target="preproc-nifti">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="save-output" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#2563EB;strokeWidth=1.5;" value="&lt;b&gt;save_output&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;+ copy_gradient_files&lt;/font&gt;" vertex="1">
          <mxGeometry height="50" width="110" x="1090" y="440" as="geometry" />
        </mxCell>
        <mxCell id="output-section" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="280" width="270" x="1250" y="360" as="geometry" />
        </mxCell>
        <mxCell id="output-label" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=16;fontColor=#64748B;fontStyle=1" value="OUTPUT" vertex="1">
          <mxGeometry height="20" width="250" x="1260" y="395" as="geometry" />
        </mxCell>
        <mxCell id="preproc-nifti" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=2;" value="&lt;b&gt;Preprocessed NIfTI&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;*_dwi_preproc.nii.gz&lt;br&gt;*_dwi_preproc.bval&lt;br&gt;*_dwi_preproc.bvec&lt;/font&gt;" vertex="1">
          <mxGeometry height="80" width="180" x="1295" y="425" as="geometry" />
        </mxCell>
        <mxCell id="brain-mask-output" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DCFCE7;strokeColor=#22C55E;strokeWidth=2;" value="&lt;b&gt;Brain Mask&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;*_brain_mask.nii.gz&lt;/font&gt;" vertex="1">
          <mxGeometry height="50" width="180" x="1295" y="545" as="geometry" />
        </mxCell>
        <mxCell id="arrow-mask-to-out" edge="1" parent="1" source="mask-out" style="endArrow=classic;html=1;strokeWidth=1.5;strokeColor=#22C55E;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="brain-mask-output" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="835" y="570" />
              <mxPoint x="920" y="570" />
              <mxPoint x="1230" y="570" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cli-section" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="320" width="400" x="60" y="680" as="geometry" />
        </mxCell>
        <mxCell id="cli-label" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=15;fontColor=#64748B;fontStyle=1" value="CLI PARAMETERS" vertex="1">
          <mxGeometry height="20" width="400" x="60" y="685" as="geometry" />
        </mxCell>
        <mxCell id="cli-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF7ED;strokeColor=#FB923C;strokeWidth=1;align=left;spacingLeft=15;fontSize=10;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;Courier New&quot;&gt;&lt;b&gt;csttool preprocess&lt;/b&gt;&lt;br&gt;&lt;br&gt;--dicom /path/to/dicom/&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Path to DICOM directory&lt;br&gt;&lt;br&gt;--nifti /path/to/file.nii.gz&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Path to NIfTI file&lt;br&gt;&lt;br&gt;--out /path/to/output/&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Output directory (required)&lt;br&gt;&lt;br&gt;--coil-count 4&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Receiver coils for PIESNO (default: 4)&lt;br&gt;&lt;br&gt;--perform-motion-correction&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Enable motion correction (optional)&lt;br&gt;&lt;br&gt;--show-plots&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Show QC visualizations&lt;/font&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="270" width="360" x="80" y="715" as="geometry" />
        </mxCell>
        <mxCell id="struct-section" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="320" width="350" x="500" y="680" as="geometry" />
        </mxCell>
        <mxCell id="struct-label" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=15;fontColor=#64748B;fontStyle=1" value="OUTPUT DIRECTORY STRUCTURE" vertex="1">
          <mxGeometry height="20" width="350" x="500" y="685" as="geometry" />
        </mxCell>
        <mxCell id="struct-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F0FDF4;strokeColor=#22C55E;strokeWidth=1;align=left;spacingLeft=15;fontSize=10;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;font face=&quot;Courier New&quot;&gt;output/&lt;br&gt;├── preprocessed/&lt;br&gt;│&amp;nbsp;&amp;nbsp; ├── *_dwi_preproc.nii.gz&lt;br&gt;│&amp;nbsp;&amp;nbsp; ├── *_dwi_preproc.bval&lt;br&gt;│&amp;nbsp;&amp;nbsp; ├── *_dwi_preproc.bvec&lt;br&gt;│&amp;nbsp;&amp;nbsp; └── *_brain_mask.nii.gz&lt;br&gt;│&lt;br&gt;├── intermediate/&lt;br&gt;│&amp;nbsp;&amp;nbsp; └── *_dwi_denoised.nii.gz&lt;br&gt;│&lt;br&gt;├── nifti/&lt;br&gt;│&amp;nbsp;&amp;nbsp; └── (converted from DICOM)&lt;br&gt;│&lt;br&gt;└── logs/&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; └── *_preprocessing_report.json&lt;/font&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="270" width="310" x="520" y="715" as="geometry" />
        </mxCell>
        <mxCell id="notes-section" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#94A3B8;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="320" width="450" x="890" y="680" as="geometry" />
        </mxCell>
        <mxCell id="notes-label" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=15;fontColor=#64748B;fontStyle=1" value="NOTES" vertex="1">
          <mxGeometry height="20" width="450" x="890" y="685" as="geometry" />
        </mxCell>
        <mxCell id="notes-box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8FAFC;strokeColor=#CBD5E1;strokeWidth=1;align=left;spacingLeft=15;fontSize=10;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;Processing Steps:&lt;/b&gt;&lt;br&gt;&lt;br&gt;1. &lt;b&gt;load_dataset&lt;/b&gt;: Load NIfTI + build gradient table from bval/bvec&lt;br&gt;&lt;br&gt;2. &lt;b&gt;denoise_nlmeans&lt;/b&gt;: PIESNO estimates noise level, NLMEANS applies non-local means denoising&lt;br&gt;&lt;br&gt;3. &lt;b&gt;background_segmentation&lt;/b&gt;: median_otsu on b0 volumes creates brain mask&lt;br&gt;&lt;br&gt;4. &lt;b&gt;perform_motion_correction&lt;/b&gt; (optional): Between-volume rigid registration&lt;br&gt;&lt;br&gt;5. &lt;b&gt;save_output&lt;/b&gt;: Writes preprocessed data + copies gradient files&lt;br&gt;&lt;br&gt;&lt;b&gt;Coil Count (N):&lt;/b&gt;&lt;br&gt;• N=4 for GRAPPA parallel imaging&lt;br&gt;• N=1 for SENSE parallel imaging&lt;/div&gt;" vertex="1">
          <mxGeometry height="270" width="410" x="910" y="715" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
